"use strict";function newEl(tag,opt){tag=tag||"div";var el=document.createElement(tag);for(var prop in opt)if(prop.hasOwnProperty)if("style"===prop)for(var styleProp in opt[prop])el[prop][styleProp]=opt[prop][styleProp];else el[prop]=opt[prop];return el}function runCallbacks(){callbacks.forEach(function(callback){callback(finalScore)})}function getMedianScore(){if(scores.length){var scoreArray=scores,midPoint=Math.floor(scoreArray.length/2),result=void 0;return scoreArray.sort(),result=scoreArray.length%2?scoreArray[midPoint]:(scoreArray[midPoint-1]+scoreArray[midPoint])/2,Math.round(result)}}function log(str){if(!document.querySelector("#logging-panel")){var logEl=newEl("div",{id:"logging-panel",style:{position:"fixed",width:"300px",height:"260px",bottom:"10px",left:"10px",padding:"10px",background:"#111","font-family":"monospace","font-size":"12px","line-height":"14px",color:"#eee",overflow:"auto","box-shadow":"2px 2px 20px rgba(0, 0, 0, 0.5)","z-index":"99"}}),logH1=newEl("h1",{textContent:"Fireball"});logEl.appendChild(logH1);var logMedian=newEl("p",{id:"log-median"});logEl.appendChild(logMedian);var logDiv=newEl("div",{id:"log"});logEl.appendChild(logDiv),document.querySelector("body").appendChild(logEl)}var log=document.querySelector("#log");"_finished_"===str?(document.querySelector("#log-median").textContent="Score: "+getMedianScore().toLocaleString(),log.style.color="grey"):log.innerHTML+="<p> >"+str+"</p>"}function appendClasses(options){var i=void 0,className=options.speedRanges[0].className;for(i=1;i<options.speedRanges.length;i++)finalScore>=options.speedRanges[i].min&&(className=options.speedRanges[i].className);if(options.speedRanges.forEach(function(speedRange){finalScore>=speedRange.min&&(className=speedRange.className)}),className){var classSelector=options.classEl||"body",classEl=document.querySelector(classSelector);classEl&&classEl.classList.add(className)}}function runFireball(options){function logScore(rawScore){var thisScore=parseInt(6.1813*rawScore,10);scores.push(thisScore),finalScore=getMedianScore(),count++,debug&&log(finalScore.toLocaleString()),runs>count?window.setTimeout(function(){fbWorker.postMessage("run")},100):(hasFinished=!0,runCallbacks(),debug&&log("_finished_"),options.speedRanges&&appendClasses(options),options.callback&&options.callback())}if(finalScore=options.defaultScore||0,!window.Worker)return void(options.callback&&options.callback());options=options||{};var debug=options.debug||!1,runs=options.runs||7,count=0,fbWorker=new Worker("/fireball-js/fireball_worker.js");fbWorker.addEventListener("message",function(e){logScore(e.data)},!1),fbWorker.postMessage("run")}function getScore(){return finalScore}function addCallback(callback){hasFinished?callback(finalScore):callbacks.push(callback)}Object.defineProperty(exports,"__esModule",{value:!0});var callbacks=[],finalScore=0,hasFinished=!1,scores=[];exports.default={run:runFireball,getScore:getScore,onSuccess:addCallback},module.exports=exports.default;